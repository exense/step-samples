---
name: "synthetic-monitoring-playwright"
plans:
  - name: "Opencart synthetic monitoring plan"
    root:
      testCase:
        children:
          - callKeyword:
              keyword: "Buy MacBook in OpenCart"
  - name: "Opencart schedule assertion plan"
    root:
      assertionPlan:
        description: "Assert the scheduled execution never fails and meet response times requirements"
        children:
          - assertMetric:
              description: "assert average duration is below threshold (ms) for last 10 minutes"
              comparator: LOWER_THAN
              aggregation: AVG
              expectedValue: 5000
              metric: "response-time"
              slidingWindow: 600000
              errorCode: 11 #custom error code
              filters:
                - field: "attributes.name"
                  filterType: EQUALS
                  filter: "Buy MacBook in OpenCart"
              # evaluate next assertion too even if this one fails
              continueParentNodeExecutionOnError: true
          - assertMetric:
              description: "Make sure no execution failed in last 10 minutes"
              comparator: LOWER_THAN
              aggregation: SUM
              expectedValue: 1
              metric: "executions/failure-count"
              slidingWindow: 600000
              errorCode: 10 #custom error code
schedules:
  - name: "Opencart synthetic monitoring schedule"
    #CRON expression for one execution per minute
    cron: "0 0/1 * * * ?"
    planName: "Opencart synthetic monitoring plan"
    assertionPlanName: "Opencart schedule assertion plan"
alertingRules:
  - description: "Send email for incident created for Opencart synthetic monitoring"
    name: "Opencart synthetic monitoring email"
    active: true
    eventClass: IncidentOpenedEvent
    conditions:
      - BindingCondition:
          bindingKey: "executionDescription"
          predicate:
            BindingValueEqualsPredicate:
              value: "Opencart synthetic monitoring plan"
    actions:
      - NotificationViaGatewayAction:
          gatewayName: "Email notification gateway"
          gatewayParameters:
            - "changeme@changeme.changeme"
